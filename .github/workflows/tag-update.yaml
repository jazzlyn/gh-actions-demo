---
name: tag-update

on:
  workflow_dispatch:
  repository_dispatch:
    types:
      - integration-nginx
      - staging-nginx

jobs:
  integration-tag-update:
    if: ${{ github.event.action == 'integration-nginx' }}
    uses: "strg-at/github-workflows/.github/workflows/value-updater-yaml.yaml@feature/NOENT-3682-setup-value-updater-yaml"
    with:
      runner: '["ubuntu-latest"]'
      value: ${{ github.event.client_payload.tag }}
      value-path: .app.backend.code
      file-path: versions/integration.yaml
      create-pr: false
      commit-branch: ${{ github.ref_name}}
      commit-message: "release(backend): update integration to ${{ github.event.client_payload.tag }}"
    secrets:
      github-app-id: ${{ secrets.JAZZLYN_BOT_GITHUB_APP_ID }}
      github-app-key: ${{ secrets.JAZZLYN_BOT_GITHUB_PEM }}

  staging-tag-update:
    if: ${{ github.event.action == 'staging-nginx' }}
    uses: "strg-at/github-workflows/.github/workflows/value-updater-yaml.yaml@feature/NOENT-3682-setup-value-updater-yaml"
    with:
      runner: '["ubuntu-latest"]'
      value: ${{ github.event.client_payload.tag }}
      value-path: .app.backend.code
      file-path: versions/staging.yaml
      create-pr: false
      commit-branch: ${{ github.ref_name}}
      commit-message: "release(backend): update staging to ${{ github.event.client_payload.tag }}"
    secrets:
      github-app-id: ${{ secrets.JAZZLYN_BOT_GITHUB_APP_ID }}
      github-app-key: ${{ secrets.JAZZLYN_BOT_GITHUB_PEM }}
